<!DOCTYPE html>
<html>
  <head>
    <title>Capture</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link rel='stylesheet' href='/stylesheets/bootstrap.min.css' />
    <script type="text/javascript" src="/scripts/headtrackr.js"></script>
    <script type="text/javascript" src="/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="/scripts/local.js"></script>
  </head>
  <body>
    <div class="animationDiv">
	    <div class="well well-lg" style="text-align: center"><h3>Hey, how do you feel?</h3></div>
	    <div class="sad mood">
	    	<img src="/images/sad.jpg"/>
	    	<div class="overlay"></div>
	    </div>
	    <div class="happy mood">
	    	<img src="/images/happy.jpg"/>
	    	<div class="overlay"></div>
	    </div>
	</div>
    
    <div class="indicator" id="indicator">
    	<script>
    		ajaxCall('/showGauge', 'indicator');
    	</script>
    </div>
    
	<canvas id="inputCanvas" width="320" height="240" style="display:none"></canvas>
	<video id="inputVideo" autoplay loop style="display:none"></video>
	<canvas id="overlay" width="320" height="240" style="display:none"></canvas>
	
	<script type="text/javascript">
	  var videoInput = document.getElementById('inputVideo');
	  var canvasInput = document.getElementById('inputCanvas');
	  var canvasOverlay = document.getElementById('overlay')
	  var overlayContext = canvasOverlay.getContext('2d');
	  
	  var flag = 0;
	  var eventX = 1;
	  
	  canvasOverlay.style.position = "absolute";
	  canvasOverlay.style.top = '0px';
	  canvasOverlay.style.zIndex = '100001';
	  canvasOverlay.style.display = 'none';
	
	  var htracker = new headtrackr.Tracker();
	  //htracker.init(videoInput, canvasInput);
	  //htracker.start();
	  
	  /*document.addEventListener("facetrackingEvent", function( event ) {
		// clear canvas
		overlayContext.clearRect(0,0,320,240);
		// once we have stable tracking, draw rectangle
		if (event.detection == "CS") {
			overlayContext.translate(event.x, event.y)
			overlayContext.rotate(event.angle-(Math.PI/2));
			overlayContext.strokeStyle = "#00ff00";
			overlayContext.strokeRect((-(event.width/2)) >> 0, (-(event.height/2)) >> 0, event.width, event.height);
			overlayContext.rotate((Math.PI/2)-event.angle);
			overlayContext.translate(-event.x, -event.y);
		}
	   });
	   
	   setTimeout(function() {
	   	document.addEventListener("headtrackingEvent", headTrackingEventFunction);	
	   }, 8000);*/
	   
	   function headTrackingEventFunction( event ) {
			/*if(!flag) setTimeout(headTrackingEventFunctionRemainder, 5000);*/
			eventX = event.x;
			headTrackingEventFunctionRemainder();
	   }
	   
	   function headTrackingEventFunctionRemainder(event) {
	   	if(eventX <= 0) {
			$('.mood.sad .overlay').css('display','block');
			$('.mood.happy .overlay').css('display','none');
			logMood('indicator', 'sad');
			document.removeEventListener("headtrackingEvent", headTrackingEventFunction);
		} else {
			$('.mood.happy .overlay').css('display','block');
			$('.mood.sad .overlay').css('display','none');
			logMood('indicator', 'happy');
			document.removeEventListener("headtrackingEvent", headTrackingEventFunction);
		}
	   }
	
	</script>
    
  </body>
</html>